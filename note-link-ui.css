:root{
  --ink:#e7eefb; --muted:#475569; --bg:#0b1020; --accent:#50c878;
}

*{box-sizing:border-box}
html,body{height:100%}
body{font-family:system-ui, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
     color:var(--ink); background:var(--bg);}

/* トップバー */
.topbar{display:flex; gap:12px; align-items:center; justify-content:space-between;
  padding:10px 12px; position:sticky; top:0; z-index:30;
  background:rgba(10,14,28,.6); backdrop-filter:blur(6px); border-bottom:1px solid #1b2439;}
.topbar .ver{opacity:.8; font-weight:600}
.topbar .btn{margin-left:6px}

/* ボタン共通 */
.btn{appearance:none; border:1px solid #2a3551; background:#121927; color:var(--ink);
  padding:6px 10px; border-radius:10px; cursor:pointer}
.btn:hover{box-shadow:0 0 0 2px rgba(80,200,120,.25) inset; color:#eafff3}
.btn.ghost{background:transparent}
.btn.danger{background:#2b1418; border-color:#5b1c24; color:#ffd7df}
.btn.danger:hover{box-shadow:0 0 0 2px #5b1c24 inset}

/* レイアウト */
#wrap{display:grid; grid-template-columns: auto 1fr; height:calc(100% - 52px);}
.stage{position:relative}
#canvas{position:absolute; inset:0; width:100%; height:100%;}

/* サイドバー */
.sidebar{width:64px; border-right:1px solid #1b2439; padding:8px 6px; display:flex;
  flex-direction:column; gap:8px; align-items:center; background:#0e1526; position:relative; z-index:20;
  transition:width .2s ease;}
.sidebar[data-collapsed="1"]{width:36px}
.sidebar .collapse{
  width:28px; height:28px; border-radius:8px; display:grid; place-items:center; margin:4px 0 6px;
  background:#0f1a2e; border:1px solid #22304e; cursor:pointer;
}
.sidebar .collapse .tri{width:16px; height:16px; fill:#a8b4d4; transition:transform .2s ease}
.sidebar[data-collapsed="1"] .collapse .tri{transform:rotate(180deg)}
.sidebar .tool{
  width:44px; height:44px; border-radius:12px; background:#0f1a2e; border:1px solid #22304e;
  display:grid; place-items:center; cursor:pointer; transition:all .12s ease; position:relative;
}
.sidebar[data-collapsed="1"] .tool{width:28px; height:28px; border-radius:8px}
.sidebar .tool svg{width:20px; height:20px; filter:grayscale(1) brightness(1.05)}
.sidebar[data-collapsed="1"] .tool svg{width:16px; height:16px}
.sidebar .tool:hover{box-shadow:0 0 0 2px rgba(80,200,120,.2) inset}
.sidebar .tool.active{
  outline:2px solid var(--accent); box-shadow:0 0 10px rgba(80,200,120,.55);
}
.sidebar .settings{margin-top:auto}

/* パレット（設定） */
.palette{position:absolute; left:84px; top:80px; width:320px; background:#0e1424; border:1px solid #22304e;
  border-radius:16px; padding:14px; box-shadow:0 10px 30px rgba(0,0,0,.35); z-index:25}
.palette__title{display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; font-weight:700}
.palette label{display:grid; grid-template-columns:72px 1fr; align-items:center; gap:10px; margin:8px 0}
.palette input[type="range"]{width:100%}
.palette input[type="color"]{width:40px; height:28px; padding:0; border:1px solid #22304e; background:#0b1020;
  border-radius:6px}
.panel{display:none}

/* 上部のシンプルボタン */
.page-ops .btn{min-width:56px}

/* 印刷用 */
@media print{
  .topbar, .sidebar, .palette{display:none !important}
  #wrap{grid-template-columns:1fr}
}
/* === toolbar fixes v0.6.9-fix2 === */
:root{
  --tool-btn: 42px;         /* ボタン枠サイズ */
  --icon-size: 22px;        /* アイコンサイズ */
  --active-glow: 0 0 0 3px rgba(132,240,201,.9);
}

/* 共通サイズ */
.sidebar .tool,
.sidebar .toggle-btn{
  width:var(--tool-btn);
  height:var(--tool-btn);
}

/* アイコンサイズ */
.sidebar .tool svg,
.sidebar .toggle-btn svg{
  width:var(--icon-size);
  height:var(--icon-size);
}

/* アクティブは「ツールのみ」 */
.sidebar .tool.active{
  outline:2px solid #84f0c9;
  box-shadow:var(--active-glow);
  border-radius:10px;
}
/* トグルはアクティブ装飾なし */
.sidebar .toggle-btn{
  outline:none;
  box-shadow:none;
}

/* 折り畳み時は幅をしっかり詰めてノート領域に干渉しない */
.sidebar[data-collapsed="1"]{ width:44px; }
.sidebar[data-collapsed="1"] .tool-label{ display:none; }
